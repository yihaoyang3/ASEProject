<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>display</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/css/bootstrap-4.3.1.min.css}">
    <link rel="stylesheet" th:href="@{/css/project/mapbrowse.css}">
</head>
<body>

<div class="buttoms">
    <div style="position: absolute; right: 20px; bottom:20px; z-index: 999">
        <button onclick="zoombig()">Zoom-In</button>
        &nbsp;&nbsp;
        <button onclick="zoomsmall()">Zoom-Out</button>
        &nbsp;&nbsp;
        <button onclick="getDefault()">Reset</button>
    </div>
</div>

<div class="modal fade" id="popup-on-mapblock-selected" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="">
                    <div class="container">
                        <div class="row" style="margin-top:20px;">
                            <div class="col text-center">
                                <label id="popupmapIdLabel" hidden="hidden" th:value="${mapId}"></label>
                                <input type="text" class="form-control" name= "LocationName" id="LocationName" placeholder="Location Name">
                            </div>
                        </div>
                        <div class="row" style="margin-top:20px;">
                            <div class="col">
                                <input id="LocationDescriptionMedia" name= "LocationDescriptionMedia"  type="file" accept= "image/*,video/*" multiple><br>
                            </div>
                        </div>
                        <div class="row" style="margin-top:20px;">
                            <div class="col text-center">
                                <button type="button" class="btn btn-primary SaveLocationInformation" id="SaveLocationInformation">Save changes</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--<div class="visible-cover relative">
    <div style="width: 100%; height: auto; position: absolute; left: 0; top: 0; z-index: 0;" id="vis">
        <div th:each="row:${mapBlocks}" style="display: flex; flex-wrap: nowrap;height: auto">
            <div th:each="col:${row}" style="height: auto">
                <img style="width: 100%; height: auto" th:src="'data:image/jpeg;base64,'+${col}" name="map-block" class="block" th:draggable="false">
            </div>
        </div>
    </div>
</div>-->

<div class="visible-cover relative">
    <div class="drag-framework-inner" id="vis">
        <div id="map-container" class="map-framework">

        </div>
    </div>
</div>
<label id="mapIdLabel" hidden="hidden" th:value="${mapId}"></label>
</body>
<style type="text/css">
    .visible-cover{
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        border:2px solid #000;
        float:left;
        margin-right:20px;
    }
    .relative{
        position: relative;
    }
    .SaveLocationInformation {
	background-color: black;
	border: 2px solid white;
	border-radius: 30px;
	text-decoration: none;
	padding: 10px 28px;
	color: white;
	margin-top: 10px;
	display: inline-block;
}
.SaveLocationInformation:hover {
		background-color: white;
		color: black;
		border: 2px solid black;
	}
</style>

<script th:src="@{/js/jquery/jquery-3.3.1.js}"></script>
<script th:src="@{/js/map/mapbrowse.js}"></script>
<script type="text/javascript">

    $(".SaveLocationInformation").click(function() {
        var formData= new FormData();
        debugger;
        let itemMap = new Map();
        itemMap.set('mapId', $("#mapIdLabel").attr("value"));
        itemMap.set('locationName', document.getElementById("LocationName").value);
        //var itemData = {mapId:$("#mapIdLabel").attr("value"),
        //                locationName:document.getElementById("LocationName").value};
        let fileblob=new Blob([document.getElementById('LocationDescriptionMedia').files[0]],{type:'jpg'});
        formData = {
                    'itemInfo': itemMap,
                    'media': [fileblob]
                    };
        $.ajax({url: "/mapEdit/addLocation?itemInfo=${itemMap}&media=${fileblob}",
                type: 'POST',
                dataType: 'json',
                processData: false,
                data: formData,
                success: function(result) {
                    console.log('click')
                    console.log(result);
                },
                error: function(result) {
                    alert("error in saving location information");
                }
        });
    });

    $(function () {
        let mapId = $("#mapIdLabel").attr("value");
        $.ajax({
            type: 'get',
            url: '/map/browse/getMap?id=' + mapId,
            success: function (data, status, jqXHR) {
                data = JSON.parse(data);
                let imgType = 'data:image/jpeg;base64,';
                for (let i = 0; i < data.length; i++) {
                    let rowId = '#row' + i;
                    let rowDiv = '<div class="map-row" id="' + 'row' + i + '"></div>'
                    $(rowDiv).appendTo("#map-container");
                    for (let j = 0; j < data[i].length; j++) {
                        let mapBlock = '<img name="map-block" class="block" data-toggle="modal" data-target="#popup-on-mapblock-selected" draggable="false" src="' + imgType +
                            data[i][j] +
                            '">';
                        $(mapBlock).appendTo(rowId);
                    }
                }
            }
        });
    });

    $('#map-container').on('mouseover','img',function (){
        this.style.borderStyle = "solid";
        this.style.borderColor = "cyan";
    });

    $('#map-container').on('mouseout','img',function (){
        this.style.borderStyle = "";
        this.style.borderWidth = "";
        this.style.borderColor = "";
    });

    $('.map-block-selected').on('click', function() {
    $('#popup-on-mapblock-selected').toggle();
    })

</script>
</html>